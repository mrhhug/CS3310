<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:a="http://rainier.kennesaw.edu/2006/Assignment" xmlns:cwi="http://rainier.kennesaw.edu/2006/CourseWideInformation"><head xmlns="">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"><meta name="Author" content="Alan Shaw"><title>CS 3310 - Fall 2013</title><link rel="stylesheet" href="OldStyleVariant.css" type="text/css"></head><body><div xmlns="" id="header"><img class="headerimage" src="database.png" altsrc="5 cubes inscribed in an icosohedron.  Each cube is a different color" height="150">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CS 3310 - Fall 2013</div>
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td align=left width=60></td>
<td>

    <h1>Assignment #7: Database Implementation</h1>

<p>
In this Assignment you will learn the basics of how to create tables for your own Custom Shopping Cart web application using Visual Studio 2010 and the MVC framework (Model-View-Controller).  In the MVC framework, your tables will serve as the Model, the Views will be created using templates you will be given, and C# code serves as the Controller.  Most of the Controller code will be provided for you</p>

<p>To get started, download the <a href="ShoppingCartV1.zip">ShoppingCartV1.zip</a> archived project folder.  This project is a Visual Studio ASP.NET MVC 2 Web Application.  Unzip the file and place the <b>ShoppingCartV1</b> folder into your Projects folder inside of your Visual Studio 2010 folder.
<p>
Once you have done that, you can start up Visual Studio 2010, and then go to the File menu, and choose "Open" and then "Project/Solution", and then find the ShoppingCartV1 folder, and open it, and then select the "ShoppingCartV1.sln" file you will see underneath another ShoppingCartV1 folder, and then click on the "Open" button to open up your ShoppingCartV1 website project.
<p>
Your IDE can have many windows showing at the same time.  Three windows that you should try and make sure are visible are your <b>Solution Explorer</b>, your <b>Server Explorer</b>, and your <b>Error List</b> windows.  To make each window show up if it is hidden, go to your View menu, and select the window from there to make it visible.  In the following example you can see a standard layout for organizing these windows, putting the <b>Server Explorer</b> on your left, the <b>Solution Explorer</b> on the right, and the <b>Error List</b> centered at the bottom.  That leaves the middle for your coding windows and table modifications.  But you are not required to organize your windows this way.
<p>
<img src=Explorers.png width=600>
<p>
The next step to take is to create your database. To do that, right-click on the "App_Data" folder in the <b>Solution Explorer</b> and select Add and then New Item, and then click on Data and SQL Server Database, and place <u>ShoppingCartDB.mdf</u> in the Name field:
<p>
<img src=ShoppingCart1.png width=600>
<p>
When it is created, you should see your Database in the <b>Server Explorer</b>.  When it is there, you will create two tables in your database, the <u>Customers</u> table and the <u>Products</u> table.
<hr>
<center>The Customers Table</center>
<p>To create the <u>Customers</u> table open up the ShoppingCardDB.mdf item by clicking on the arrow next to it, and then right-click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this  table, and notice that the ID field is a Primary Key, and it is an "Identity Specification" field.  Also not which fields "Allow Nulls" and which do not: 
<p>
<img src=ShoppingCart2.png>
<p>
Now save your Table and give it the name <u>Customers</u>.  
<p>
<img src=ShoppingCart2B.png>
<p>
Next, you will create a new Model for your table.  This step creates the documents necessary to link your table to your C# code.  If you do not do this step correctly, your program will not work even if your table is correct.  You create your Model by right-clicking on the Models folder in the <b>Solution Explorer</b> and selecting Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>CustomersModel.edmx</u>:
<p>
<img src=ShoppingCart3.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=ChooseModel.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities".
<p>
<img src=ShoppingCart4.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the Customers table:
<p>
<img src=ShoppingCart5.png width=600>
<p>
When you click on the finish button, you will have a CustomersModel.edmx file in your Models folder, and you will see the Customer record as follows.
<p>
<img src=ShoppingCart6.png>
<p>
Now you are finished with creating the Customers table.
<hr>
<center>The Products Table</center>
<p>To create the <u>Products</u> table go into the <b>Server Explorer</b> and open up the Tables folder inside of the ShoppingCartDB database.  To add the Products table to the database, right click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this table, and notice that the ProductID field is a Primary Key, and it is an "Identity Specification" field.  And also note that only the ProductName field and the ImageFile fields are marked as "Allow Nulls": 
<p>
<img src=ShoppingCart7.png>
<p>
Now save your Table and give it the name <u>Products</u>.  
<p>
<img src=ShoppingCart8.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the <b>Solution Explorer</b> and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>ProductsModel.edmx</u>:
<p>
<img src=ShoppingCart9.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=ChooseModel.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities1".  If you don't see a "1", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart10.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the Products table only, and not the other table:
<p>
<img src=ShoppingCart11.png width=600>
<p>
When you click on the finish button, you will have a ProductsModel.edmx file in your Models folder, and you will see the WebsiteProduct record as follows.
<p>
<img src=ShoppingCart12.png>
<p>
Now you are finished with creating the Products table.
<p>
<hr>
<p>
If you ran into a problem and did not see a "1" in your Entity name when you were creating your Products model, you will have to take an extra step.  The Entity name should have been "ShoppingCartDBEntities1", but if you ran into a problem and had to do that step multiple times, the name may end in something other than "1".  If if does not end in a "1" then you need to go into your Controllers folder in the <b>Solution Explorer</b>, and then double-click on the PartialCode.cs file to open it up.  <p>
About half way down in that file you will see the name "ShoppingCartDBEntities1" twice on one line.  Change the "1" to whatever number you had in your Entity name to fix the problem caused by using a different number there.  Then you can close this file.
<p>
<hr>
<p>
The next thing you should do is go to the "Build" menu and choose "Build Solution".  This is an important step because it validates that you have done everything correct up to this point.  If you have not done everything correctly, you will see some error messages in your <b>Error List</b> window at this point.  If you do see error messages, you must resolve them before moving on.
<p>
<hr>
<p>
Next, you should add product data to your Products table.  To do this just right-click on the table name in the <b>Server Explorer</b>, and choose "Show Table Data".  And then you can enter in the product data line by line.  This data consist of the Product Type (which is also the Product View name), the Product Name, the name of the Image File for the product, the Unit Price for the product, the Max Amount of items a user can purchase of the product (put -1 if there is no maximum), and the initial default number of product items to purchase (this should usually be zero).
<p>
Note that you must add your images to the Contents folder separately.  For this project, your cake images have been added to the Contents folder for you in advance.  But for the next project you will have to load your own product images files into the Contents folder and then put the filenames of those images into your Products table.  If you don't add an image filename for a product inside your table, a [No Image] label will be shown.
<p>
The following is an example of table data for the Single Layer Cake product view of the Fun Cake Store shown below:
<p>
<hr>
<p>
<img src=ShoppingCart13.png>
<p>
<hr>
<p>
<font size=4><b>Single Layer Cake Order:</b></font> 
<p>
<table border="1" cellspacing="0" cellpadding="10">
    <tr>
    <td align="center"><b>Item Image</b></td>
    <td align="center"><b>Price Per Item</b></td>
    <td align="center"><b>Order Amount</b></td>
    </tr>
    <tr>
    <td align="center">Layer 1 - Flower:<br><img src=Layer1Option1.jpg /></td>
    <td align="center"><b>$5.99</b></td>
    <td><b>Amount of this item: </b><select name="ListItems1">
        <option>0</option>
        <option >1</option>
        <option >2</option>
        <option >3</option>
        <option >4</option>
        <option >5</option>
        <option >6</option>
        <option >7</option>
        <option >8</option>
        <option >9</option>
        <option >10</option>
        </select>
    </td>
    </tr>
    <tr>
    <td align="center">Layer 1 - Star:<br><img src=Layer1Option2.jpg /></td>
    <td align="center"><b>$10.99</b></td>
    <td><b>Amount of this item: </b><select name="ListItems2">
        <option>0</option>
        <option >1</option>
        <option >2</option>
        <option >3</option>
        <option >4</option>
        <option >5</option>
        <option >6</option>
        <option >7</option>
        <option >8</option>
        <option >9</option>
        <option >10</option>
        </select>
    </td>
    </tr>
    <tr>
    <td align="center">Layer 1 - Strawberry:<br><img src=Layer1Option3.jpg /></td>
    <td align="center"><b>$15.99</b></td>
    <td><b>Amount of this item: </b><input type="text" name="ListItems3" value="0" style="border-style:1px solid #000; width: 30px;" />
    </td>
    </tr>
</table>
<img src=twobuttons.png>
<p>
<hr>
<p>
Each of your product views would show the user a page consisting of the product images, their prices, and a field that determines how many items of that product the user wants to purchase.
<p>
For your Fun Cake Store you will have 3 categories of cakes: 1) Single Layer Cakes, 2) Double Layer Cakes, and 3) Triple Layer Cakes.  The tabs for the product views for those 3 categories along with a "Home" tab and an "About" tab will look like the following:
<p>
<hr>
<p>
<img src=projv1tabs.png>
<p>
<hr>
<p>
Below is a list of images for those 5 product views and below that are examples of what those views should look like with the right table information:
<p>
<hr>
<p>
<ul>
<li><b>1-Layer</b></li>
<ul>
<li><a href="Layer1Option1.jpg" target="_blank">Layer1Option1.jpg</a></li>
<li><a href="Layer1Option2.jpg" target="_blank">Layer1Option2.jpg</a></li>
<li><a href="Layer1Option3.jpg" target="_blank">Layer1Option3.jpg</a></li>
</ul>
<li><b>2-Layer</b></li>
<ul>
<li><a href="Layer2Option1.jpg" target="_blank">Layer2Option1.jpg</a></li>
<li><a href="Layer2Option2.jpg" target="_blank">Layer2Option2.jpg</a></li>
<li><a href="Layer2Option3.jpg" target="_blank">Layer2Option3.jpg</a></li>
</ul>
<li><b>3-Layer</b></li>
<ul>
<li><a href="Layer3Option1.jpg" target="_blank">Layer3Option1.jpg</a></li>
<li><a href="Layer3Option2.jpg" target="_blank">Layer3Option2.jpg</a></li>
<li><a href="Layer3Option3.jpg" target="_blank">Layer3Option3.jpg</a></li>
</ul>
</ul>
<p>
<hr>
<p>
<a href="proj1view1.png" target="_blank">See The First View</a>
</p>
<p>
<a href="proj1view2.png" target="_blank">See The Second View</a>
</p>
<p>
<a href="proj1view3.png" target="_blank">See The Third View</a>
</p>
<p>
<hr>
Only one product view's code is in the HomeController.cs file.  You need to add the <b>.aspx</b> view page (the page with the HTML in it) for this code, and after that you need to add the C# code and the other view pages for the other two product tabs.  <p>
To add the <b>.aspx</b> view page, right-click on the Tab1Orders method name in the HomeController.cs file and select "Add View", and then where it says "Select Master Page", click on the button and choose ShoppingCart1.Master and then click on Add.  When you have done this you will be taken to the newly created view page.  Click on the "Source" option at the bottom, and you will see the following code:
<p>
<pre>
    &lt;h2&gt;Tab1Orders&lt;/h2&gt;
</pre>
<p>
Replace this code with the following code:
<p>
<pre>
    &lt;h2&gt;&lt;%= ViewData["Message"]%&gt;&lt;/h2&gt;
</pre>
<p>
You are now finished with the Tab1Orders view and you should be able to run your code and see the tab for Single Layer cakes.
<p>

<hr>

<p>In order for the products to show up correctly on the website you will need to have the correct product images to the Contents folder, and the right table data in your Products table.  You can add images to your Contents folder by right-clicking on it and choosing "Add" and then "Existing Item..." and then browse for your image files and select them and click on the "Add" button.

<p>Your cake images are already loaded for you, but you need to add the corresponding information into your Products table.  To do this, follow these steps:

<p>
<ol><li> Open up the "ShoppingCartDB.mdf" database in the <b>Server Explorer</b>.  Then open the Tables folder and right-click on Products table and select "Show Table Data".  After that you should see where you add the actual data in the Products table and you should be able to change the image files listed there so that they become the names of the image files you added to the Content folder.  When you have done that you should see your images when you run the program instead of the cake images.

<p><li>For each view, you can add as many product images as you like, but for this assignment you will just be adding three images for each tab, as shown above.  If you put a positive number in the MaxAmout column, the website will display a dropdown allowing the user to choose no more than that many items of that product.  But if you put -1 in the MaxAmount, then the view will dispay a simple input box for the number of products to buy, and the user can type in as high a value as they like.

<p><li>You can change the Heading shown for your product from "The Fun Cake Store" to whatever heading you want for the name of your online store.  Do this by changing the <b>siteHeading</b> value in the HomeController.cs code near the top to the correct text that you want.

<p><li>To add the tabs for the other two product views to your program, just create two more strings in your <b>tabLabels</b> array, saying "2-Layer" and "3-Layer", for the second and thir product.  You will find the <b>tabLabels</b> array near the top in the HomeController.cs code.

<p><li>Next, add subheadings on those two product views by adding two strings in your <b>tabHeadings</b> array, naming these subheading something like "Double Layer Cake" and "Triple Layer Cake".  You will also find the <b>tabHeadings</b> array near the top in the HomeController.cs code.


<p><li>Next, add new strings to the <b>tabViews</b> array that represent the names of the C# methods for the new tabs that run when those tabs are clicked.  To keep it simple you can make the new view names "Tab2Orders" and "Tab3Orders" (although you can use any names you like for the views as long as you remember to use those same names inside the Products table in the ProductType column to assign those views the correct product information, and you will need to use the same names as the method names for the view methods as described below).

<p><b>Note:</b> Your <b>tabViews</b> array, <b>tabLabels</b> array, and your <b>tabHeadings</b> array <b>should always have the same amount of items</b> in them because they have corresponding information.

<p>Now you must add the appropriate data to the Products table, noting that the ProductType field is supposed to have the same value as the method name in the <b>tabViews</b> array for that particular tab.

<p><li>When you have finished adding your data to Products table, you have to create two controller methods with the name of each view you are adding.  Each view requires two methods with the same name, just as you can see that there are two methods with the name "Tab1Orders" already in the HomeController.cs file.
<p>To add the two methods needed for each of your other product views you will just duplicate the two "Tab1Orders" methods and change their names (to "Tab2Orders" or "Tab3Orders").  And then inside of those methods just add one to the index in the <b>tabViews</b> and <b>tabHeadings</b> arrays that are in those methods, and add 1 to the number sent to loadViewTableData() in the return of that method.  And then add one to the value that tabNum equals in your second of the two methods.  So for instance, after making your changes for the "Tab2Orders" view you added, you will end up with two new Tab2Orders methods like so:
<p>
<hr>
<p>
<pre><font size=3>
        // Action Method for Second Product View
        public ActionResult Tab2Orders()
        {
            Session["ProductType"] = tabViews[2];
            ViewData["Message"] = Session["Message"] = tabHeadings[2] + " Orders:";
            return View(loadViewTableData(Session["ProductType"].ToString(),2));
        }

        // Action Method for Second Product View
        [HttpPost]
        public ActionResult Tab2Orders(string button, FormCollection collection)
        {
            string pType = Session["ProductType"].ToString();
            int amount = Int32.Parse(Session[pType + "ItemAmount"].ToString());
            int tabNum = 2;
            LoadSubmission(pType, amount, collection);

            for (int i = 1; i &lt;= amount; i++)
            {
                int value;
                if (!Int32.TryParse(collection[i - 1], out value) || value < 0)
                {
                    ViewData.ModelState.AddModelError("", "Error: You put an invalid amount in Item #" + i);
                    ViewData["Message"] = Session["Message"];
                    return View(pType, loadViewTableData(pType,tabNum));
                }
            }

            if (button == "Save And Go To Checkout")
            {
                return RedirectToAction("CheckOut");
            }
            else
            {
                return RedirectToAction(tabViews[tabNum+1]);  // This is the View for the next product page
            }
        }
</font></pre>
<p>
<hr>
<p><li>With the above code added to your program (and similar code added for <b>Tab3Orders</b>), you are almost ready to run your new views on your website.  All you need to do now is create the  the <b>.aspx</b> View page file for the new views that you are implementing in this code.  To do that for each new view name, right-click on the method name (Tab2Orders or Tab3Orders) and select "Add View", and then where it says "Select Master Page", click on the button and choose ShoppingCart1.Master and then click on Add.  When you have done this you will be taken to the newly created view page.  Click on the "Source" option at the bottom, and you will see the following code:
<p>
<pre>
    &lt;h2&gt;Tab2Orders&lt;/h2&gt;
</pre>
<p>
Or it may say Tab3Orders, or whatever your new view name is called.  Whatever is there, replace this code with the following code:
<p>
<pre>
    &lt;h2&gt;&lt;%= ViewData["Message"]%&gt;&lt;/h2&gt;
</pre>
<p>
Do these steps only once for each new view.  So even though you have two methods for the Tab2Orders view, you will only go through this process once for the Tab2Orders view, and once for the Tab3Orders view if you have a Tab3Orders view, and so on.
<p>
<hr>
<p><li>When you have finished the above changes, your project should run and you should be able to see your tabs with their product views.  However, your Home page (the index page) is probably still showing something like the following:
<p>
<img src=homepage1.png>
<p>
This is just the default Home page, and to change it, you need to go into your Views folder, and then into your Home folder, and then open up your "Index.aspx" file by double clicking on it. Then click on the "Source" option at the bottom, and you will see the following code:
<p>
<pre>
    &lt;h2&gt;&lt;%: ViewData["Message"] %&gt;&lt;/h2&gt;
    &lt;p&gt;
        To learn more about ASP.NET MVC ...
    &lt;/p&gt;
</pre>
<p>
Once again you need to replace these 4 lines with the following 1 line of code (note you need an equal sign = in place of the colon : in the new code):
<p>
<pre>
    &lt;h2&gt;&lt;%= ViewData["Message"]%&gt;&lt;/h2&gt;
</pre>
<p>
Now, go back into your HomeController.cs code, and in the index() method near the top, replace the following line of C# code:<p>
<pre>
    ViewData["Message"] = "Welcome to ASP.NET MVC!";
</pre>
<p>
with the following three lines:
<p>
<pre>
    ViewData["Message"] = "Welcome to the FunCake Store!";
    ViewData["Message"] += "&lt;br /&gt;&lt;img src=/Content/logo.jpg&gt;";
    ViewData["Message"] += "&lt;br /&gt;This is the Cake Store of your Dreams!";
</pre>
<p>
This should cause a new message to display with the logo.jpg image from the Content folder, producing the following homepage message:
<p>
<img src=homepage2.png>
<p>
</ol>
<hr>
<p>
When you are finished making these changes, you should be all set.  Now when you run your website you should have the above Home page, and you should see all your product views, and those views should be using the details from your Products table.  Don't worry about the About page for now.  You will complete that page and other pages in the next assignment.
<p>
<hr>
<p>

<h2>Deliverables</h2>
<p>Zip your ShoppingCartV1 project folder (you may have to delete your old zipped ShoppingCartV1.zip file first if it is in the same folder) and then turn in your newly zipped file:</p>
    <ul>
        <li> <code>ShoppingCartV1.zip</code> </li>
    </ul>

<p>Turn in your file by uploading it as an attachment to Assignment 07 in the Homework Assignments section
of the class website in D2L.  Be sure to press the Submit button AFTER your attachment
has been uploaded.  (If you press the Submit button before your attachment has been uploaded, you
will not be able to upload the attachment later.  If that happens email it to me at 
    <a href="mailto:ashaw8@kennesaw.edu">ashaw8@kennesaw.edu</a>.)</p>

    <table class="important"><tr><td>
            Assignment Due: November ???, 2013
            by 11:59 PM
        </td></tr></table>
   
</td>
</tr>
</table>

</body></html>