<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:xi="http://www.w3.org/2001/XInclude" xmlns:a="http://rainier.kennesaw.edu/2006/Assignment" xmlns:cwi="http://rainier.kennesaw.edu/2006/CourseWideInformation"><head xmlns="">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type"><meta name="Author" content="Alan Shaw"><title>CS 3310 - Spring 2014</title><link rel="stylesheet" href="OldStyleVariant.css" type="text/css"></head><body><div xmlns="" id="header"><img class="headerimage" src="database.png" altsrc="5 cubes inscribed in an icosohedron.  Each cube is a different color" height="150">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CS 3310 - Spring 2014</div>
<table border=0 cellspacing=0 cellpadding=0>
<tr>
<td align=left width=60></td>
<td>

    <h1>Assignment #8: Database Implementation Pt. 2</h1>
<p>
For this assignment you will build the remaining tables you need for your ShoppingCart website.  To finish the website you need the following additional Tables:
<p>
<ul>
<li>Options
<li>Intersections
<li>PurchaseOrders
<li>LineItems
<li>OptionAssociations
</ul>
<p>
The first of these tables is the Options table that will list a set of options that your products might offer that can either increase the price (if they are accessories) or decrease the price (if they are discounts).
<p>
The Options table will be implemented as an independent table from the Products table.  This approach allows for a set of options to be used by more than one product, but this approach also requires an additional Intersections table be created to identify which products offer which options.
<p> 
For instance, on the Fun Cake Store website, the first tab had 3 different Cakes that could be ordered and their product IDs were 1, 2 and 3.  If an Options table existed for the Fun Cake Store website, it might have the following data:
<p>
<img src=CakeDataTBL1.png>
<p>
This data lists 2 optional accessories for cakes, the first of which is to "Personalize With Name" your cake for an additional $1.99, and the second of which is to add "Extra Frosting" for an additional $0.99.  The data also list 3 optional discounts for cakes. The "No Frosting" discount takes $1.00 off of the price, and the "Have Coupon" discount takes $0.50 off the price, and the "Member Discount" takes $1.00 off of the price. 
<p>
With this Options table data, you might also have the following Intersections table data:
<p>
<img src=CakeDataTBL2.png>
<p>
This table data links the first cake product with the first 2 optional accessories, and it also links the second cake product with the first 2 optional accessories.  Then it links the third cake product with the 3 optional discounts.
<p>
In Part 2 of this assignment you will be given the code you need to make your options data show up on your website.  But for Part 1, all you are supposed to do is build your tables and that the code will use to access your tables.
<p>

<hr>
<center>The Options Table</center>
<p>To create the <u>Options</u> table open up the ShoppingCardDB.mdf item by clicking on the arrow next to it, and then right-click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this  table, and notice that the OptionsID field is a Primary Key, and it is an "Identity Specification" field.  Also notice that no fields "Allow Nulls" this time: 
<p>
<img src=ShoppingCart14.png>
<p>
Now save your Table and give it the name <u>Options</u>.  
<p>
<img src=ShoppingCart15.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the Solution Explorer and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>OptionsModel.edmx</u>:
<p>
<img src=ShoppingCart16.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=KSUCornerDB4.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities2".  If you don't see a "2", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart17.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the Options table:
<p>
<img src=ShoppingCart18.png width=600>
<p>
When you click on the finish button, you will have a OptionsModel.edmx file in your Models folder, and you will see the Option record as follows.
<p>
<img src=ShoppingCart19.png>
<p>
Now you are finished with creating the Options table.
<hr>
<center>The Intersections Table</center>
<p>To create the <u>Intersections</u> table go into the Server Explorer and open up the Tables folder inside of the ShoppingCartDB database.  To add the Intersections table to the database, right click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this table, and notice that both fields are Primary Keys, and neither is an "Identity Specification" field.  And also note that neither field is marked as "Allow Nulls": 
<p>
<img src=ShoppingCart20.png>
<p>
Now save your Table and give it the name <u>Intersections</u>.  
<p>
<img src=ShoppingCart21.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the Solution Explorer and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>IntersectionsModel.edmx</u>:
<p>
<img src=ShoppingCart22.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=KSUCornerDB4.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities3".  If you don't see a "3", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart23.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the Intersections table only, and not the other tables:
<p>
<img src=ShoppingCart24.png width=600>
<p>
When you click on the finish button, you will have a IntersectionsModel.edmx file in your Models folder, and you will see the Intersection record as follows.
<p>
<img src=ShoppingCart25.png>

<p>
Now you are finished with creating the Intersections table.
<hr>
<center>The PurchaseOrders Table</center>
<p>To create the <u>PurchaseOrders</u> table go into the Server Explorer and open up the Tables folder inside of the ShoppingCartDB database.  To add the PurchaseOrders table to the database, right click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this table, and notice that the OrderID field is a Primary Key, and it is an "Identity Specification" field. Also notice that no fields "Allow Nulls" this time:
<p>
<img src=ShoppingCart26.png>
<p>
Now save your Table and give it the name <u>PurchaseOrders</u>.  
<p>
<img src=ShoppingCart27.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the Solution Explorer and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>PurchaseOrdersModel.edmx</u>:
<p>
<img src=ShoppingCart28.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=KSUCornerDB4.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities4".  If you don't see a "4", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart29.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the PurchaseOrders table only, and not the other tables:
<p>
<img src=ShoppingCart30.png width=600>
<p>
When you click on the finish button, you will have a PurchaseOrdersModel.edmx file in your Models folder, and you will see the PurchaseOrder record as follows.
<p>
<img src=ShoppingCart31.png>

<p>
Now you are finished with creating the PurchaseOrders table.
<hr>
<center>The LineItems Table</center>
<p>To create the <u>LineItems</u> table go into the Server Explorer and open up the Tables folder inside of the ShoppingCartDB database.  To add the LineItems table to the database, right click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this table, and notice that both the OrderID field and the LineNumber field are Primary Keys, and neither one is an "Identity Specification" field. Also notice that no fields "Allow Nulls" this time:
<p>
<img src=ShoppingCart32.png>
<p>
Now save your Table and give it the name <u>LineItems</u>.  
<p>
<img src=ShoppingCart33.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the Solution Explorer and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>LineItemsModel.edmx</u>:
<p>
<img src=ShoppingCart34.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=KSUCornerDB4.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities5".  If you don't see a "5", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart35.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the LineItems table only, and not the other tables:
<p>
<img src=ShoppingCart36.png width=600>
<p>
When you click on the finish button, you will have a LineItemsModel.edmx file in your Models folder, and you will see the LineItem record as follows.
<p>
<img src=ShoppingCart37.png>


<p>
Now you are finished with creating the LineItems table.
<hr>
<center>The OptionAssociations Table</center>
<p>To create the <u>OptionAssociations</u> table go into the Server Explorer and open up the Tables folder inside of the ShoppingCartDB database.  To add the OptionAssociations table to the database, right click on the Tables folder and select "Add New Table".  Next, you will create the following fields in this table, and notice that all three fields are Primary Keys, and none of them is an "Identity Specification" field.  And also note that no field is marked as "Allow Nulls": 
<p>
<img src=ShoppingCart38.png>
<p>
Now save your Table and give it the name <u>OptionAssociations</u>.  
<p>
<img src=ShoppingCart39.png>
<p>
Next, you will create a new Model for your table by right-clicking  on the Models folder in the Solution Explorer and select Add and then New Item. Select the Data category and select the ADO.NET Entity Data Model template. Then give your data model the name <u>OptionAssociationsModel.edmx</u>:
<p>
<img src=ShoppingCart40.png width=600>
<p>
After you click the Add button, the Entity Data Model Wizard appears, and under the line "What should the model contain?" select the Generate from database option.
<p>
<img src=KSUCornerDB4.png>
<p>
Then in the next screen, in the drop-down box under the line "Which data connection should your application use to connnect to the database?", choose ShoppingCartDB.mdf, and note that the "entity connection settings" shown at the bottom should say "ShoppingCartDBEntities6".  If you don't see a "6", take special note of the number you do see because you will need to use that number later.
<p>
<img src=ShoppingCart41.png width=600>
<p>
After you click the Next button, you will go to the "Choose Your Database Objects" screen, where you must expand the Tables node, and select the OptionAssociations table only, and not the other tables:
<p>
<img src=ShoppingCart42.png width=600>
<p>
When you click on the finish button, you will have a OptionAssociationsModel.edmx file in your Models folder, and you will see the OptionAssociation record as follows.
<p>
<img src=ShoppingCart43.png>

<p>
Now you are finished with creating the OptionAssociations table.

<p>
<hr>
<p>
After you have created your new tables, you should have seven tables in all listed here in alphabetical order:
<p>
<ul>
<li>Customers
<li>Intersections
<li>LineItems
<li>OptionAssociations
<li>Options
<li>Products
<li>PurchaseOrders
</ul>
<p>
Some of these tables have foreign keys in them, so the next thing you must do is set up the foreign key relationships as follows:
<p>
<ul>
<li>In the <b>Intersections</b> table the <u>ProductID</u> field is a foreign key to the same field in the <b>Products</b> table.  And in the same <b>Intersections</b> table the <u>OptionID</u> field is a foreign key to the same field in the <b>Options</b> table.
<p>
<li>In the <b>LineItems</b> table the <u>OrderID</u> field is a foreign key to the same field in the <b>PurchaseOrders</b> table.  And in the same <b>LineItems</b> table the <u>ProductID</u> field is a foreign key to the same field in the <b>Products</b> table.
<p>
<li>In the <b>OpenAssociations</b> table the <u>OrderID</u> field is a foreign key to the same field in the <b>PurchaseOrders</b> table.  And in the same <b>OpenAssociations</b> table the <u>ProductID</u> field is a foreign key to the same field in the <b>Products</b> table.  And in the same <b>OpenAssociations</b> table the <u>OptionID</u> field is a foreign key to the same field in the <b>Options</b> table.
<p>
<li>In the <b>PurchaseOrders</b> table the <u>CustomerID</u> field is a foreign key to the <u>ID</u> field in the <b>Customers</b> table.
</ul>
<p>
<hr>
<p>
Now you are ready to add new files that are needed to manage the new funcitonality that will be supported by the new tables.  The first two of these files is the a new Product model file that supports adding options to a product, ProductWithOption.cs, and the second is a new Master template file that gives new functionality to the views, ShoppingCart2.Master.
<p>
<ul>
<li><a href="ProductWithOption.cs" target="_blank">ProductWithOption.cs</a></li>
<li><a href="ShoppingCart2.Master" target="_blank">ShoppingCart2.Master</a></li>
</ul>
<p>
The ProductWithOption.cs file goes into your Models folder and the ShoppingCart2.Master file goes into your Shared folder inside of your Views folder.  So download the files, and then add then the appropriate folder in your project by right-clicking on the folder and choosing "Add" and then "Existing Item..." and then browse to where you saved the files and then click on each one in turn and then click on the "Add" button. 
<p>
Once you have these two files loaded, you need to change your existing tab views (Tab1Orders, Tab2Orders, etc.) so that they use the new template instead of the older one. The best way to do this is to go into the Home folder in the Views folder, and open each one separately, Tab1Orders.aspx, then Tab2Orders.aspx and so on, and then go into the "Source" view for each of them (by clicking on "Source" at the bottem on the left) and then on the Top line of each file, where it says MasterPageFile="~/Views/Shared/ShoppingCart1.Master"
 and change it by putting a two in for the one so that it says MasterPageFile="~/Views/Shared/ShoppingCart2.Master".

After doing this you are ready to add the other files you need.  The following ones go into your Models folder again:

<p>
<ul>
<li><a href="Customer.cs" target="_blank">Customer.cs</a></li>
<li><a href="CustomerWithPurchase.cs" target="_blank">CustomerWithPurchase.cs</a></li>
<li><a href="Product.cs" target="_blank">Product.cs</a></li>
<li><a href="PurchaseOrderWithDetails.cs" target="_blank">PurchaseOrderWithDetails.cs</a></li>
</ul>
<p>

After you have loaded these file, you need to load the following one, and this time put them into your Home folder inside of your Views folder:

<p>
<ul>
<li><a href="Admin.aspx" target="_blank">Admin.aspx</a></li>
<li><a href="CheckOut.aspx" target="_blank">CheckOut.aspx</a></li>
<li><a href="ConfirmPurchase.aspx" target="_blank">ConfirmPurchase.aspx</a></li>
<li><a href="CreateIntersection.aspx" target="_blank">CreateIntersection.aspx</a></li>
<li><a href="CreateOption.aspx" target="_blank">CreateOption.aspx</a></li>
<li><a href="CreateProduct.aspx" target="_blank">CreateProduct.aspx</a></li>
<li><a href="CustomerDetails.aspx" target="_blank">CustomerDetails.aspx</a></li>
<li><a href="Customers.aspx" target="_blank">Customers.aspx</a></li>
<li><a href="DeleteIntersection.aspx" target="_blank">DeleteIntersection.aspx</a></li>
<li><a href="DeleteOption.aspx" target="_blank">DeleteOption.aspx</a></li>
<li><a href="DeleteProduct.aspx" target="_blank">DeleteProduct.aspx</a></li>
<li><a href="EditCustomer.aspx" target="_blank">EditCustomer.aspx</a></li>
<li><a href="EditOption.aspx" target="_blank">EditOption.aspx</a></li>
<li><a href="EditProduct.aspx" target="_blank">EditProduct.aspx</a></li>
<li><a href="Error.aspx" target="_blank">Error.aspx</a></li>
<li><a href="IntersectionDetails.aspx" target="_blank">IntersectionDetails.aspx</a></li>
<li><a href="Intersections.aspx" target="_blank">Intersections.aspx</a></li>
<li><a href="OptionDetails.aspx" target="_blank">OptionDetails.aspx</a></li>
<li><a href="Options.aspx" target="_blank">Options.aspx</a></li>
<li><a href="OrderDetails.aspx" target="_blank">OrderDetails.aspx</a></li>
<li><a href="ProductDetails.aspx" target="_blank">ProductDetails.aspx</a></li>
<li><a href="Products.aspx" target="_blank">Products.aspx</a></li>
<li><a href="Purchases.aspx" target="_blank">Purchases.aspx</a></li>
<li><a href="ShoppingCartAccount.aspx" target="_blank">ShoppingCartAccount.aspx</a></li>
</ul>
<p>
<hr>
<p>
Now you are ready to modify your HomeController.cs file. The first change to make to your HomeController is you must add the following lines at the top with the other "using" statements that declare the libraries that you are using:
<p>
<pre>
using System.Collections;
using System.IO;
using System.Drawing;
using System.Text.RegularExpressions;
</pre>
<p>
Next, add the following array to the top of your program along with the other arrays and change the label headings in this array so that they match what you want as the heading of the options column for each of your product views -- so if you have 3 products, you should replace at least 3 of the labels you see starting with "Single Layer Options":
<p>
<pre>
        // Text for View Heading of any Options columns
        string[] optionsColumnHeading = { "", "Single Layer Options",
                                           "Double Layer Options",
                                           "Triple Layer Options", "" };
</pre>
<p>
Next, right below that array, add the following values which set the tax rate and the return email address that will go into emails that are sent by the website after a user has made a purchase.  Notice that the address contains the words "funcakestore", but that should change since your Shopping cart does not sell cakes, like mine:
<p>
<pre>
        // The tax rate is 5%
        decimal taxRate = 0.05M;

        // Email address of the company that will be in the "From" box of the confirmation message sent
        string websiteEmail = "order@funcakestore.com";
</pre>
<p>
Next, you must remove two methods that you used in Assignment 7, so you can reload the new versions of them.  Those two methods are LoadSubmission() and loadViewTableData().  Once you remove those two methods, you should be able to load the new code without a problem.  However, there is a lot of new code, so I've placed it in a separate file.  To load the new code, copy and paste it into the HomeController.cs file just above the last two close braces } at the bottom of the file.  Do not remove those last two close braces, just copy and paste the new code above them.  Clck on the following link to get to the new code:
<p>
<ul>
<li><a href="shoppingcartcode.txt" target="_blank">Shopping Cart Code</a></li>
</ul>
<p>
<hr>
<p>
After loading the code, you should be able to run your website with the Options features implemented for each tab without errors.  Two other new features that you MUST implement are the Check-Out view and the Admin view.  To get these two views to show up and work, you need to add them to your arrays at the top of your program.  You should add them in front of your About view, so that means that after adding the two new view strings you will have the following three strings as the last strings in your <b>tabHeadings</b> array:
<p>
<pre>
        "Check-Out", "Admin", "About"
</pre> 
<p>
And you will have the following three strings as the last strings in your <b>tabViews</b> array:
<p>
<pre>
        "CheckOut", "Admin", "About"
</pre> 
<p>
And you will have the following three strings as the last strings in your <b>tabLabels</b> array:
<p>
<pre>
        "Check-Out", "Admin", "About"
</pre> 
<p>
And you will have the following three strings as the last strings in your <b>optionsColumnHeading</b> array:
<p>
<pre>
        "", "", ""
</pre> 
<p>
Now all of your features should be implemented and working.  However, to test your Admin view, you will be required to log in.  And in order to log in you need to create an account for yourself.  To do this, go to the Log On page and at the top of the page you will see a sentence with a "Register" link.  Click on that link and then fill in the information to create an account for yourself.  Note that you will have to create an account with a password of at least six characters.
<p>
When you have created the account, you should be click on the "Admin" view and then see that you can now access and review the following 5 tables over the website, and with the last three you can also alter their contents:
<p>
<ol>
<li>Customer Accounts</li>
<li>Purchase Orders</li>
<li>Products Table</li>
<li>Options Table</li>
<li>Intersections Table</li>
</ol>
<p>
<hr>
<p>
Now for your final task, <u>you must be sure to put a welcoming message and an image appropriate</u> to your website on your front page by placing the code for that message and image into your Index() method near the top of your HomeController.cs.<p>
Along with that, <u>you must put a message that lists all of the users in your group </u>on the About page by placing the code for that message into your About() method.  You can use the <a href="aboutus.jpg">aboutus.jpg</a> image that was provided for you as part of Assignment 7, or if you have an image that is more appropriate, feel free to use that.
<hr>
<p>
Now, if you have gotten everything to work, you are finally done.
<p>

<hr>
<p>
<h2>Deliverables</h2>
<p>Zip your ShoppingCart project folder and then turn in the following file:</p>
    <ul>
        <li> <code>ShoppingCart.zip</code> </li>
    </ul>

<p>You only need to turn in one ZIP file per team with all of your product views in it, but I encourage each member of your team to go through the steps of getting this code working on their own computer in order to get a little familiar with Visual Studio.

<p>Turn in your file by uploading it as an attachment to Assignment 07 in the Homework Assignments section
of the class website in D2L.  Be sure to press the Submit button AFTER your attachment
has been uploaded.  (If you press the Submit button before your attachment has been uploaded, you
will not be able to upload the attachment later.  If that happens email it to me at 
    <a href="mailto:ashaw8@kennesaw.edu">ashaw8@kennesaw.edu</a>.)</p>

    <table class="important"><tr><td>
            Assignment Due: May 1, 2014
            by 11:59 PM
        </td></tr></table>
   
</td>
</tr>
</table>

</body></html>